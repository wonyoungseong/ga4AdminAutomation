<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ShowStats() í•¨ìˆ˜ ìµœì¢… ê²€ìˆ˜</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            color: #333;
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 2px solid #ddd; 
            border-radius: 10px;
            background: #f9f9f9;
        }
        .test-section.success { border-color: #4CAF50; background: #e8f5e8; }
        .test-section.error { border-color: #f44336; background: #ffeaea; }
        .test-section.info { border-color: #2196F3; background: #e3f2fd; }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        button { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn-primary { background: #2196F3; color: white; }
        .btn-primary:hover { background: #1976D2; transform: translateY(-2px); }
        .btn-success { background: #4CAF50; color: white; }
        .btn-success:hover { background: #45a049; transform: translateY(-2px); }
        .btn-warning { background: #ff9800; color: white; }
        .btn-warning:hover { background: #f57c00; transform: translateY(-2px); }
        .btn-danger { background: #f44336; color: white; }
        .btn-danger:hover { background: #d32f2f; transform: translateY(-2px); }
        
        #log { 
            background: #1e1e1e; 
            color: #00ff00;
            border: 2px solid #333; 
            padding: 20px; 
            height: 400px; 
            overflow-y: auto; 
            font-family: 'Courier New', monospace; 
            font-size: 13px;
            border-radius: 8px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .status-card {
            display: inline-block;
            margin: 10px;
            padding: 20px;
            border: 3px solid #2196F3;
            border-radius: 12px;
            background: white;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .status-card:hover { transform: scale(1.05); }
        .status-card.updated { 
            border-color: #4CAF50; 
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6); }
            100% { box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); }
        }
        
        .iframe-container {
            margin: 20px 0;
            border: 3px solid #666;
            border-radius: 10px;
            height: 600px;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .result-summary {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .result-summary.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        .result-summary.failure {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ShowStats() í•¨ìˆ˜ ìµœì¢… ê²€ìˆ˜ ì‹œìŠ¤í…œ</h1>
            <p>GA4 ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ showStats() í•¨ìˆ˜ ë™ì‘ì„ ì¢…í•©ì ìœ¼ë¡œ ê²€ì¦í•©ë‹ˆë‹¤</p>
        </div>

        <div class="test-grid">
            <div class="test-section info">
                <h3>ğŸ¯ í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h3>
                <div class="button-group">
                    <button class="btn-primary" onclick="runFullTest()">ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn-success" onclick="testAPIStructure()">ğŸ“¡ API êµ¬ì¡° í™•ì¸</button>
                    <button class="btn-warning" onclick="testShowStatsFunction()">âš¡ showStats() í…ŒìŠ¤íŠ¸</button>
                    <button class="btn-danger" onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
                </div>
            </div>

            <div class="test-section" id="resultSection">
                <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
                <div id="testResults">
                    <p>í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ ì‹¤ì‹œê°„ í†µê³„ ì¹´ë“œ (ì—…ë°ì´íŠ¸ ëª¨ë‹ˆí„°ë§)</h3>
            <div class="status-card" id="total-accounts-card">
                <h4>ğŸ“Š ì´ ê³„ì •</h4>
                <div class="value">ë¡œë”©ì¤‘...</div>
            </div>
            <div class="status-card" id="total-properties-card">
                <h4>ğŸ  ì´ í”„ë¡œí¼í‹°</h4>
                <div class="value">ë¡œë”©ì¤‘...</div>
            </div>
            <div class="status-card" id="active-users-card">
                <h4>ğŸ‘¥ í™œì„± ì‚¬ìš©ì</h4>
                <div class="value">ë¡œë”©ì¤‘...</div>
            </div>
            <div class="status-card" id="expiring-soon-card">
                <h4>âš ï¸ ë§Œë£Œ ì˜ˆì •</h4>
                <div class="value">ë¡œë”©ì¤‘...</div>
            </div>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>ğŸ–¥ï¸ ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ (ëŒ€ì‹œë³´ë“œ)</h3>
                <div class="iframe-container">
                    <iframe src="http://localhost:8000/" id="dashboardFrame"></iframe>
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="executeShowStatsInFrame()">ğŸ¯ Frameì—ì„œ showStats() ì‹¤í–‰</button>
                    <button class="btn-success" onclick="refreshFrame()">ğŸ”„ Frame ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>

            <div class="test-section">
                <h3>ğŸ“‹ ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                <div id="log"></div>
            </div>
        </div>

        <div id="finalResult" class="result-summary" style="display: none;">
            <!-- ìµœì¢… ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <script>
        let testResults = {
            apiStructure: false,
            showStatsFunction: false,
            frameExecution: false
        };

        // ë¡œê¹… í•¨ìˆ˜
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00ff00',
                success: '#4CAF50',
                error: '#ff4444',
                warning: '#ffaa00'
            };
            
            const entry = document.createElement('div');
            entry.style.color = colors[type] || colors.info;
            entry.innerHTML = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            console.clear();
            log('ğŸ—‘ï¸ ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤', 'info');
        }

        // API êµ¬ì¡° í…ŒìŠ¤íŠ¸
        async function testAPIStructure() {
            log('ğŸ“¡ API êµ¬ì¡° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/stats');
                log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.ok ? 'âœ…' : 'âŒ'}`, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                log('ğŸ“„ ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ë¶„ì„:', 'info');
                log(`  - success: ${data.success}`, 'info');
                log(`  - data ì¡´ì¬: ${!!data.data}`, 'info');
                log(`  - data.stats ì¡´ì¬: ${!!(data.data && data.data.stats)}`, 'info');
                
                if (data.success && data.data && data.data.stats) {
                    log('âœ… API êµ¬ì¡° í…ŒìŠ¤íŠ¸ ì„±ê³µ! (data.data.stats ê²½ë¡œ í™•ì¸)', 'success');
                    const stats = data.data.stats;
                    log(`ğŸ“Š í†µê³„ ë°ì´í„°: ê³„ì •=${stats.total_accounts}, í”„ë¡œí¼í‹°=${stats.total_properties}, ì‚¬ìš©ì=${stats.active_users}`, 'success');
                    testResults.apiStructure = true;
                    return true;
                } else {
                    log('âŒ API êµ¬ì¡° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ì˜¬ë°”ë¥¸ ë°ì´í„° êµ¬ì¡°ê°€ ì•„ë‹˜', 'error');
                    testResults.apiStructure = false;
                    return false;
                }
                
            } catch (error) {
                log(`âŒ API êµ¬ì¡° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                testResults.apiStructure = false;
                return false;
            }
        }

        // showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        async function testShowStatsFunction() {
            log('âš¡ showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                // ìˆ˜ì •ëœ showStats() í•¨ìˆ˜ ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
                const response = await fetch('http://localhost:8000/api/stats');
                const data = await response.json();
                
                log('ğŸ” showStats() í•¨ìˆ˜ ë¡œì§ ê²€ì¦:', 'info');
                
                // ìˆ˜ì •ëœ ì¡°ê±´ë¬¸ í…ŒìŠ¤íŠ¸
                if (data.success && data.data && data.data.stats) {
                    const stats = data.data.stats;
                    log('âœ… ìˆ˜ì •ëœ ë°ì´í„° ì ‘ê·¼ ë°©ì‹ ì„±ê³µ: data.data.stats', 'success');
                    
                    // ì‹¤ì œ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                    updateStatusCard('total-accounts-card', stats.total_accounts);
                    updateStatusCard('total-properties-card', stats.total_properties);
                    updateStatusCard('active-users-card', stats.active_users);
                    updateStatusCard('expiring-soon-card', stats.expiring_soon);
                    
                    log('ğŸ¯ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'success');
                    testResults.showStatsFunction = true;
                    return true;
                } else {
                    log('âŒ showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€', 'error');
                    testResults.showStatsFunction = false;
                    return false;
                }
                
            } catch (error) {
                log(`âŒ showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                testResults.showStatsFunction = false;
                return false;
            }
        }

        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateStatusCard(cardId, value) {
            const card = document.getElementById(cardId);
            if (card) {
                const valueElement = card.querySelector('.value');
                if (valueElement) {
                    const oldValue = valueElement.textContent;
                    valueElement.textContent = value;
                    card.classList.add('updated');
                    log(`ğŸ”„ ${cardId} ì—…ë°ì´íŠ¸: "${oldValue}" â†’ "${value}"`, 'success');
                    
                    // 3ì´ˆ í›„ ì• ë‹ˆë©”ì´ì…˜ ì œê±°
                    setTimeout(() => card.classList.remove('updated'), 3000);
                }
            }
        }

        // Frameì—ì„œ showStats() ì‹¤í–‰
        function executeShowStatsInFrame() {
            log('ğŸ¯ Frameì—ì„œ showStats() í•¨ìˆ˜ ì‹¤í–‰ ì‹œë„...', 'info');
            
            try {
                const frame = document.getElementById('dashboardFrame');
                const frameWindow = frame.contentWindow;
                
                if (frameWindow && typeof frameWindow.showStats === 'function') {
                    log('âœ… Frameì—ì„œ showStats() í•¨ìˆ˜ ë°œê²¬', 'success');
                    frameWindow.showStats();
                    log('ğŸš€ Frameì—ì„œ showStats() í•¨ìˆ˜ ì‹¤í–‰ë¨', 'success');
                    testResults.frameExecution = true;
                } else {
                    log('âŒ Frameì—ì„œ showStats() í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                    testResults.frameExecution = false;
                }
                
            } catch (error) {
                log(`âŒ Frameì—ì„œ showStats() ì‹¤í–‰ ì‹¤íŒ¨: ${error.message}`, 'error');
                testResults.frameExecution = false;
            }
        }

        // Frame ìƒˆë¡œê³ ì¹¨
        function refreshFrame() {
            log('ğŸ”„ Frame ìƒˆë¡œê³ ì¹¨...', 'info');
            const frame = document.getElementById('dashboardFrame');
            frame.src = frame.src;
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runFullTest() {
            log('ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            log('=' .repeat(60), 'info');
            
            // 1ë‹¨ê³„: API êµ¬ì¡° í…ŒìŠ¤íŠ¸
            const apiResult = await testAPIStructure();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // 2ë‹¨ê³„: showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
            const functionResult = await testShowStatsFunction();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // 3ë‹¨ê³„: Frame ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (3ì´ˆ í›„)
            log('â³ 3ì´ˆ í›„ Frame í…ŒìŠ¤íŠ¸ ì‹¤í–‰...', 'warning');
            setTimeout(() => {
                executeShowStatsInFrame();
                displayFinalResults();
            }, 3000);
        }

        // ìµœì¢… ê²°ê³¼ í‘œì‹œ
        function displayFinalResults() {
            const resultSection = document.getElementById('resultSection');
            const finalResult = document.getElementById('finalResult');
            const testResults_div = document.getElementById('testResults');
            
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            log('ğŸ“Š ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼:', 'info');
            log(`âœ… ì„±ê³µ: ${passedTests}/${totalTests} (${successRate}%)`, passedTests === totalTests ? 'success' : 'warning');
            log('=' .repeat(60), 'info');
            
            // ê°œë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼
            Object.entries(testResults).forEach(([test, result]) => {
                const status = result ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨';
                const type = result ? 'success' : 'error';
                log(`  - ${test}: ${status}`, type);
            });
            
            // ê²°ê³¼ ì„¹ì…˜ ì—…ë°ì´íŠ¸
            resultSection.className = `test-section ${passedTests === totalTests ? 'success' : 'error'}`;
            
            testResults_div.innerHTML = `
                <h4>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h4>
                <p><strong>ì„±ê³µë¥ : ${successRate}% (${passedTests}/${totalTests})</strong></p>
                <ul>
                    <li>API êµ¬ì¡° í…ŒìŠ¤íŠ¸: ${testResults.apiStructure ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}</li>
                    <li>showStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸: ${testResults.showStatsFunction ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}</li>
                    <li>Frame ì‹¤í–‰ í…ŒìŠ¤íŠ¸: ${testResults.frameExecution ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}</li>
                </ul>
            `;
            
            // ìµœì¢… ê²°ê³¼ í‘œì‹œ
            finalResult.style.display = 'block';
            finalResult.className = `result-summary ${passedTests === totalTests ? 'success' : 'failure'}`;
            finalResult.innerHTML = passedTests === totalTests 
                ? 'ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì„±ê³µ! showStats() í•¨ìˆ˜ê°€ ì™„ì „íˆ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!'
                : 'âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ì¶”ê°€ ìˆ˜ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ShowStats() í•¨ìˆ˜ ìµœì¢… ê²€ìˆ˜ ì‹œìŠ¤í…œ ì‹œì‘', 'success');
            log('ğŸ”§ ì•ˆë‚´:', 'info');
            log('  1. "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"ìœ¼ë¡œ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ ìë™ ì‹¤í–‰í•˜ê±°ë‚˜', 'info');
            log('  2. ê°œë³„ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ìœ¼ë¡œ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”', 'info');
            log('', 'info');
            
            // Frame ë¡œë“œ ì™„ë£Œ ëŒ€ê¸°
            const frame = document.getElementById('dashboardFrame');
            frame.onload = function() {
                log('âœ… ì›¹ì‚¬ì´íŠ¸ Frame ë¡œë“œ ì™„ë£Œ', 'success');
            };
        });
    </script>
</body>
</html> 