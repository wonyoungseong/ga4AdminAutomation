<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript 테스트</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>JavaScript 함수 테스트</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>시스템 정보</h5>
                    </div>
                    <div class="card-body">
                        <div id="system-info">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>계정:</strong> undefined개<br>
                                    <strong>프로퍼티:</strong> undefined개<br>
                                    <strong>활성 사용자:</strong> undefined명
                                </div>
                                <div class="col-md-6">
                                    <strong>만료 예정:</strong> undefined명<br>
                                    <strong>총 알림:</strong> undefined개<br>
                                    <strong>등록:</strong> undefined개
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>테스트 버튼</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" onclick="testRefreshStats()">통계 새로고침 테스트</button>
                        <button class="btn btn-secondary" onclick="testApiCall()">API 직접 호출</button>
                        <button class="btn btn-info" onclick="checkElements()">DOM 요소 확인</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>콘솔 로그</h5>
                    </div>
                    <div class="card-body">
                        <div id="console-output" style="height: 300px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 콘솔 로그를 화면에 표시하는 함수
        function addLog(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        // 원래 console.log 함수를 오버라이드
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // 통계 새로고침 함수 (dashboard.html에서 복사)
        async function refreshStats() {
            try {
                console.log('📊 통계 새로고침 시작...');
                const response = await fetch('/api/stats');
                const result = await response.json();
                
                console.log('📊 통계 응답:', result);
                
                if (result.success && result.stats) {
                    const stats = result.stats;
                    console.log('📊 받은 통계 데이터:', stats);
                    
                    // 데이터 검증
                    const totalAccounts = stats.total_accounts !== undefined ? stats.total_accounts : 0;
                    const totalProperties = stats.total_properties !== undefined ? stats.total_properties : 0;
                    const activeUsers = stats.active_users !== undefined ? stats.active_users : 0;
                    const expiringSoon = stats.expiring_soon !== undefined ? stats.expiring_soon : 0;
                    const totalNotifications = stats.total_notifications !== undefined ? stats.total_notifications : 0;
                    const totalRegistrations = stats.total_registrations !== undefined ? stats.total_registrations : 0;
                    
                    console.log('📊 검증된 데이터 - 계정:', totalAccounts, '프로퍼티:', totalProperties, '사용자:', activeUsers);
                    
                    // 시스템 정보 업데이트
                    const systemInfoElement = document.getElementById('system-info');
                    if (systemInfoElement) {
                        systemInfoElement.innerHTML = `
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>계정:</strong> ${totalAccounts}개<br>
                                    <strong>프로퍼티:</strong> ${totalProperties}개<br>
                                    <strong>활성 사용자:</strong> ${activeUsers}명
                                </div>
                                <div class="col-md-6">
                                    <strong>만료 예정:</strong> ${expiringSoon}명<br>
                                    <strong>총 알림:</strong> ${totalNotifications}개<br>
                                    <strong>등록:</strong> ${totalRegistrations}개
                                </div>
                            </div>
                        `;
                        console.log('✅ 시스템 정보 업데이트 완료');
                        addLog('✅ 시스템 정보 업데이트 성공!', 'success');
                    } else {
                        console.error('❌ system-info 요소를 찾을 수 없습니다');
                        addLog('❌ system-info 요소를 찾을 수 없습니다', 'error');
                    }
                    
                    console.log('✅ 통계 새로고침 완료');
                } else {
                    console.error('❌ 통계 응답 오류:', result);
                    addLog('❌ 통계 응답 오류', 'error');
                }
            } catch (error) {
                console.error('❌ 통계 새로고침 오류:', error);
                addLog('❌ 통계 새로고침 오류: ' + error.message, 'error');
            }
        }

        // 테스트 함수들
        function testRefreshStats() {
            addLog('🧪 refreshStats() 함수 테스트 시작');
            refreshStats();
        }

        async function testApiCall() {
            try {
                addLog('🧪 API 직접 호출 테스트 시작');
                const response = await fetch('/api/stats');
                const result = await response.json();
                addLog('API 응답: ' + JSON.stringify(result, null, 2));
            } catch (error) {
                addLog('API 호출 오류: ' + error.message, 'error');
            }
        }

        function checkElements() {
            addLog('🧪 DOM 요소 확인 테스트 시작');
            const systemInfo = document.getElementById('system-info');
            if (systemInfo) {
                addLog('✅ system-info 요소 찾음', 'success');
                addLog('현재 내용: ' + systemInfo.innerHTML);
            } else {
                addLog('❌ system-info 요소를 찾을 수 없음', 'error');
            }
        }

        // 페이지 로드 시 자동 테스트
        document.addEventListener('DOMContentLoaded', function() {
            addLog('🚀 페이지 로드 완료');
            addLog('🧪 자동 테스트 시작');
            setTimeout(() => {
                testRefreshStats();
            }, 1000);
        });
    </script>
</body>
</html> 