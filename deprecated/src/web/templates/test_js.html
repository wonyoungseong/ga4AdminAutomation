<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript í…ŒìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>JavaScript í•¨ìˆ˜ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ì‹œìŠ¤í…œ ì •ë³´</h5>
                    </div>
                    <div class="card-body">
                        <div id="system-info">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>ê³„ì •:</strong> undefinedê°œ<br>
                                    <strong>í”„ë¡œí¼í‹°:</strong> undefinedê°œ<br>
                                    <strong>í™œì„± ì‚¬ìš©ì:</strong> undefinedëª…
                                </div>
                                <div class="col-md-6">
                                    <strong>ë§Œë£Œ ì˜ˆì •:</strong> undefinedëª…<br>
                                    <strong>ì´ ì•Œë¦¼:</strong> undefinedê°œ<br>
                                    <strong>ë“±ë¡:</strong> undefinedê°œ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>í…ŒìŠ¤íŠ¸ ë²„íŠ¼</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" onclick="testRefreshStats()">í†µê³„ ìƒˆë¡œê³ ì¹¨ í…ŒìŠ¤íŠ¸</button>
                        <button class="btn btn-secondary" onclick="testApiCall()">API ì§ì ‘ í˜¸ì¶œ</button>
                        <button class="btn btn-info" onclick="checkElements()">DOM ìš”ì†Œ í™•ì¸</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ì½˜ì†” ë¡œê·¸</h5>
                    </div>
                    <div class="card-body">
                        <div id="console-output" style="height: 300px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì½˜ì†” ë¡œê·¸ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        // ì›ë˜ console.log í•¨ìˆ˜ë¥¼ ì˜¤ë²„ë¼ì´ë“œ
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // í†µê³„ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ (dashboard.htmlì—ì„œ ë³µì‚¬)
        async function refreshStats() {
            try {
                console.log('ğŸ“Š í†µê³„ ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
                const response = await fetch('/api/stats');
                const result = await response.json();
                
                console.log('ğŸ“Š í†µê³„ ì‘ë‹µ:', result);
                
                if (result.success && result.stats) {
                    const stats = result.stats;
                    console.log('ğŸ“Š ë°›ì€ í†µê³„ ë°ì´í„°:', stats);
                    
                    // ë°ì´í„° ê²€ì¦
                    const totalAccounts = stats.total_accounts !== undefined ? stats.total_accounts : 0;
                    const totalProperties = stats.total_properties !== undefined ? stats.total_properties : 0;
                    const activeUsers = stats.active_users !== undefined ? stats.active_users : 0;
                    const expiringSoon = stats.expiring_soon !== undefined ? stats.expiring_soon : 0;
                    const totalNotifications = stats.total_notifications !== undefined ? stats.total_notifications : 0;
                    const totalRegistrations = stats.total_registrations !== undefined ? stats.total_registrations : 0;
                    
                    console.log('ğŸ“Š ê²€ì¦ëœ ë°ì´í„° - ê³„ì •:', totalAccounts, 'í”„ë¡œí¼í‹°:', totalProperties, 'ì‚¬ìš©ì:', activeUsers);
                    
                    // ì‹œìŠ¤í…œ ì •ë³´ ì—…ë°ì´íŠ¸
                    const systemInfoElement = document.getElementById('system-info');
                    if (systemInfoElement) {
                        systemInfoElement.innerHTML = `
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>ê³„ì •:</strong> ${totalAccounts}ê°œ<br>
                                    <strong>í”„ë¡œí¼í‹°:</strong> ${totalProperties}ê°œ<br>
                                    <strong>í™œì„± ì‚¬ìš©ì:</strong> ${activeUsers}ëª…
                                </div>
                                <div class="col-md-6">
                                    <strong>ë§Œë£Œ ì˜ˆì •:</strong> ${expiringSoon}ëª…<br>
                                    <strong>ì´ ì•Œë¦¼:</strong> ${totalNotifications}ê°œ<br>
                                    <strong>ë“±ë¡:</strong> ${totalRegistrations}ê°œ
                                </div>
                            </div>
                        `;
                        console.log('âœ… ì‹œìŠ¤í…œ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        addLog('âœ… ì‹œìŠ¤í…œ ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ!', 'success');
                    } else {
                        console.error('âŒ system-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        addLog('âŒ system-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                    }
                    
                    console.log('âœ… í†µê³„ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                } else {
                    console.error('âŒ í†µê³„ ì‘ë‹µ ì˜¤ë¥˜:', result);
                    addLog('âŒ í†µê³„ ì‘ë‹µ ì˜¤ë¥˜', 'error');
                }
            } catch (error) {
                console.error('âŒ í†µê³„ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
                addLog('âŒ í†µê³„ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testRefreshStats() {
            addLog('ğŸ§ª refreshStats() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            refreshStats();
        }

        async function testApiCall() {
            try {
                addLog('ğŸ§ª API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                const response = await fetch('/api/stats');
                const result = await response.json();
                addLog('API ì‘ë‹µ: ' + JSON.stringify(result, null, 2));
            } catch (error) {
                addLog('API í˜¸ì¶œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        function checkElements() {
            addLog('ğŸ§ª DOM ìš”ì†Œ í™•ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            const systemInfo = document.getElementById('system-info');
            if (systemInfo) {
                addLog('âœ… system-info ìš”ì†Œ ì°¾ìŒ', 'success');
                addLog('í˜„ì¬ ë‚´ìš©: ' + systemInfo.innerHTML);
            } else {
                addLog('âŒ system-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            addLog('ğŸ§ª ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            setTimeout(() => {
                testRefreshStats();
            }, 1000);
        });
    </script>
</body>
</html> 