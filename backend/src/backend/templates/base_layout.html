<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GA4 Admin Automation - Role-based Permission Management">
    <title>{% block title %}GA4 Admin Dashboard{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Custom CSS -->
    <style>
        /* Role-based CSS Variables */
        :root {
            --color-super-admin-primary: #DC2626;
            --color-super-admin-secondary: #F59E0B;
            --color-super-admin-accent: #7C2D12;
            
            --color-admin-primary: #2563EB;
            --color-admin-secondary: #1E40AF;
            --color-admin-accent: #0EA5E9;
            
            --color-requester-primary: #059669;
            --color-requester-secondary: #047857;
            --color-requester-accent: #0D9488;
            
            --color-viewer-primary: #7C3AED;
            --color-viewer-secondary: #6B21B6;
            --color-viewer-accent: #6B7280;
        }
        
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceGentle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-4px); }
            60% { transform: translateY(-2px); }
        }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        .animate-bounce-gentle { animation: bounceGentle 2s infinite; }
        
        /* Role-specific styles */
        .role-super-admin {
            background: linear-gradient(135deg, #7C2D12 0%, #DC2626 50%, #F59E0B 100%);
        }
        
        .role-admin {
            background: linear-gradient(135deg, #1E3A8A 0%, #2563EB 50%, #0EA5E9 100%);
        }
        
        .role-requester {
            background: linear-gradient(135deg, #064E3B 0%, #059669 50%, #0D9488 100%);
        }
        
        .role-viewer {
            background: linear-gradient(135deg, #581C87 0%, #7C3AED 50%, #6B7280 100%);
        }
        
        /* Accessibility improvements */
        .focus-visible:focus {
            outline: 2px solid currentColor;
            outline-offset: 2px;
        }
        
        /* Mobile touch targets */
        @media (hover: none) and (pointer: coarse) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid currentColor;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .animate-fade-in,
            .animate-slide-up,
            .animate-bounce-gentle {
                animation: none;
            }
        }
        
        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            :root {
                color-scheme: dark;
            }
        }
    </style>
    
    <!-- Custom JavaScript -->
    <script>
        // Theme management
        function setTheme(role) {
            document.documentElement.setAttribute('data-role', role);
            localStorage.setItem('user-role', role);
        }
        
        // Initialize theme on load
        document.addEventListener('DOMContentLoaded', function() {
            const savedRole = localStorage.getItem('user-role');
            if (savedRole) {
                setTheme(savedRole);
            }
            
            // Initialize Lucide icons
            lucide.createIcons();
        });
        
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const isOpen = menu.classList.contains('translate-x-0');
            
            if (isOpen) {
                menu.classList.remove('translate-x-0');
                menu.classList.add('-translate-x-full');
            } else {
                menu.classList.remove('-translate-x-full');
                menu.classList.add('translate-x-0');
            }
        }
        
        // Notification handling
        function showNotification(type, message, duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden animate-slide-up`;
            
            const bgColor = {
                'success': 'bg-green-50 border-green-200',
                'error': 'bg-red-50 border-red-200',
                'warning': 'bg-yellow-50 border-yellow-200',
                'info': 'bg-blue-50 border-blue-200'
            }[type] || 'bg-gray-50 border-gray-200';
            
            const iconName = {
                'success': 'check-circle',
                'error': 'alert-circle',
                'warning': 'alert-triangle',
                'info': 'info'
            }[type] || 'info';
            
            notification.innerHTML = `
                <div class="p-4 ${bgColor} border-l-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i data-lucide="${iconName}" class="h-5 w-5"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">${message}</p>
                        </div>
                        <div class="ml-auto pl-3">
                            <button onclick="this.closest('.fixed').remove()" class="inline-flex text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="h-5 w-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            // Auto remove after duration
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }
        
        // Accessibility: Skip to content
        function skipToContent() {
            document.getElementById('main-content').focus();
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K for search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            // Alt + D for dashboard
            if (e.altKey && e.key === 'd') {
                e.preventDefault();
                window.location.href = '/dashboard';
            }
            
            // Alt + P for profile
            if (e.altKey && e.key === 'p') {
                e.preventDefault();
                const profileButton = document.getElementById('profile-button');
                if (profileButton) {
                    profileButton.click();
                }
            }
        });
    </script>
    
    {% block extra_head %}{% endblock %}
</head>

<body class="h-full font-sans antialiased" data-role="{% block user_role %}viewer{% endblock %}">
    <!-- Skip to content link -->
    <a href="#main-content" 
       onclick="skipToContent()" 
       class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-blue-600 text-white p-2 rounded z-50">
        Skip to main content
    </a>
    
    <!-- Main layout container -->
    <div class="min-h-full">
        {% block navigation %}{% endblock %}
        
        <!-- Main content -->
        <main id="main-content" tabindex="-1" class="flex-1">
            {% block content %}{% endblock %}
        </main>
        
        <!-- Footer -->
        {% block footer %}
        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500">
                        &copy; 2024 GA4 Admin Automation. All rights reserved.
                    </p>
                    <div class="flex space-x-4">
                        <button onclick="showNotification('info', 'Help documentation coming soon!')" 
                                class="text-sm text-gray-500 hover:text-gray-700">
                            Help
                        </button>
                        <a href="#" class="text-sm text-gray-500 hover:text-gray-700">
                            Privacy Policy
                        </a>
                        <a href="#" class="text-sm text-gray-500 hover:text-gray-700">
                            Terms of Service
                        </a>
                    </div>
                </div>
            </div>
        </footer>
        {% endblock %}
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center h-full">
            <div class="bg-white rounded-lg p-6 shadow-xl">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-2 text-sm text-gray-600">Loading...</p>
            </div>
        </div>
    </div>
    
    <!-- Mobile menu overlay -->
    <div id="mobile-menu-overlay" 
         class="fixed inset-0 bg-black bg-opacity-25 z-40 lg:hidden hidden"
         onclick="toggleMobileMenu()"></div>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>